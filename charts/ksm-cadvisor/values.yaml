prometheus:
  # enabled: true
  alertmanager:
    enabled: false
  alertmanagerFiles:
    alertmanager.yml: ""
  kubeStateMetrics:
    enabled: true
  nodeExporter:
    enabled: false
  pushgateway:
    enabled: false
  server:
    persistentVolume:
      size: 20Gi
    statefulSet:
      enabled: true
    podAnnotations:
      prometheus.io/scrape: "true"
      prometheus.io/port: "9090"
    strategy:
      type: recreate # Recreate 'capitalized'?
    global:
      evaluation_interval: 1m
      scrape_interval: 1m
      scrape_timeout: 10s
      external_labels:
        kube_cluster_name: ksm-cadvisor
  serverFiles:
    prometheus.yml: 
      scrape_configs:
      - job_name: prometheus
        static_configs:
        - targets:
          - localhost:9090
      - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
        job_name: kubernetes-apiservers
        kubernetes_sd_configs:
        - role: endpoints
        relabel_configs:
        - action: keep
          regex: default;kubernetes;https
          source_labels:
          - __meta_kubernetes_namespace
          - __meta_kubernetes_service_name
          - __meta_kubernetes_endpoint_port_name
        scheme: https
        tls_config:
          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
          insecure_skip_verify: true
      - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
        job_name: kubernetes-nodes
        kubernetes_sd_configs:
        - role: node
        relabel_configs:
        - action: labelmap
          regex: __meta_kubernetes_node_label_(.+)
        - replacement: kubernetes.default.svc:443
          target_label: __address__
        - regex: (.+)
          replacement: /api/v1/nodes/$1/proxy/metrics
          source_labels:
          - __meta_kubernetes_node_name
          target_label: __metrics_path__
        scheme: https
        tls_config:
          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
          insecure_skip_verify: true
      - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
        job_name: kubernetes-nodes-cadvisor
        kubernetes_sd_configs:
        - role: node
        relabel_configs:
        - action: labelmap
          regex: __meta_kubernetes_node_label_(.+)
        - replacement: kubernetes.default.svc:443
          target_label: __address__
        - regex: (.+)
          replacement: /api/v1/nodes/$1/proxy/metrics/cadvisor
          source_labels:
          - __meta_kubernetes_node_name
          target_label: __metrics_path__
        scheme: https
        tls_config:
          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
          insecure_skip_verify: true
      - job_name: kubernetes-service-endpoints
        kubernetes_sd_configs:
        - role: endpoints
        relabel_configs:
        - action: keep
          regex: true
          source_labels:
          - __meta_kubernetes_service_annotation_prometheus_io_scrape
        - action: replace
          regex: (https?)
          source_labels:
          - __meta_kubernetes_service_annotation_prometheus_io_scheme
          target_label: __scheme__
        - action: replace
          regex: (.+)
          source_labels:
          - __meta_kubernetes_service_annotation_prometheus_io_path
          target_label: __metrics_path__
        - action: replace
          regex: ([^:]+)(?::\d+)?;(\d+)
          replacement: $1:$2
          source_labels:
          - __address__
          - __meta_kubernetes_service_annotation_prometheus_io_port
          target_label: __address__
        - action: labelmap
          regex: __meta_kubernetes_service_label_(.+)
        - action: replace
          source_labels:
          - __meta_kubernetes_namespace
          target_label: kubernetes_namespace
        - action: replace
          source_labels:
          - __meta_kubernetes_service_name
          target_label: kubernetes_name
        - action: replace
          source_labels:
          - __meta_kubernetes_pod_node_name
          target_label: kubernetes_node
      - honor_labels: true
        job_name: prometheus-pushgateway
        kubernetes_sd_configs:
        - role: service
        relabel_configs:
        - action: keep
          regex: pushgateway
          source_labels:
          - __meta_kubernetes_service_annotation_prometheus_io_probe
      - job_name: kubernetes-services
        kubernetes_sd_configs:
        - role: service
        metrics_path: /probe
        params:
          module:
          - http_2xx
        relabel_configs:
        - action: keep
          regex: true
          source_labels:
          - __meta_kubernetes_service_annotation_prometheus_io_probe
        - source_labels:
          - __address__
          target_label: __param_target
        - replacement: blackbox
          target_label: __address__
        - source_labels:
          - __param_target
          target_label: instance
        - action: labelmap
          regex: __meta_kubernetes_service_label_(.+)
        - source_labels:
          - __meta_kubernetes_namespace
          target_label: kubernetes_namespace
        - source_labels:
          - __meta_kubernetes_service_name
          target_label: kubernetes_name
      - job_name: kubernetes-pods
        kubernetes_sd_configs:
        - role: pod
        relabel_configs:
        - action: keep
          regex: true
          source_labels:
          - __meta_kubernetes_pod_annotation_prometheus_io_scrape
        - action: replace
          regex: (.+)
          source_labels:
          - __meta_kubernetes_pod_annotation_prometheus_io_path
          target_label: __metrics_path__
        - action: replace
          regex: ([^:]+)(?::\d+)?;(\d+)
          replacement: $1:$2
          source_labels:
          - __address__
          - __meta_kubernetes_pod_annotation_prometheus_io_port
          target_label: __address__
        - action: labelmap
          regex: __meta_kubernetes_pod_label_(.+)
        - action: replace
          source_labels:
          - __meta_kubernetes_namespace
          target_label: kubernetes_namespace
        - action: replace
          source_labels:
          - __meta_kubernetes_pod_name
          target_label: kubernetes_pod_name
      - job_name: kubernetes-kube-controller-manager
        honor_labels: true
        kubernetes_sd_configs:
        - role: pod
        relabel_configs:
        - action: keep
          source_labels:
          - __meta_kubernetes_namespace
          - __meta_kubernetes_pod_name
          separator: '/'
          regex: 'kube-system/kube-controller-manager.+'
        - source_labels:
          - __address__
          action: replace
          target_label: __address__
          regex: (.+?)(\\:\\d+)?
          replacement: $1:10252
        - source_labels:
          - __meta_kubernetes_pod_name
          action: replace
          target_label: instance
        - action: labelmap
          regex: __meta_kubernetes_pod_label_(.+)
      - job_name: kubernetes-kube-scheduler
        honor_labels: true
        kubernetes_sd_configs:
        - role: pod
        relabel_configs:
        - action: keep
          source_labels:
          - __meta_kubernetes_namespace
          - __meta_kubernetes_pod_name
          separator: '/'
          regex: 'kube-system/kube-scheduler.+'
        - source_labels:
          - __address__
          action: replace
          target_label: __address__
          regex: (.+?)(\\:\\d+)?
          replacement: $1:10251
        - source_labels:
          - __meta_kubernetes_pod_name
          action: replace
          target_label: instance
        - action: labelmap
          regex: __meta_kubernetes_pod_label_(.+)
      - job_name: kube-state-metrics
        honor_labels: true
        kubernetes_sd_configs:
        - role: pod
        relabel_configs:
        - action: keep
          source_labels:
          - __meta_kubernetes_namespace
          - __meta_kubernetes_pod_name
          separator: '/'
          regex: 'monitoring/prometheus-kube-state-metrics.+'
        - source_labels:
          - __address__
          action: replace
          target_label: __address__
          regex: (.+?)(\\:\\d+)?
          replacement: $1
        - source_labels:
          - __meta_kubernetes_pod_name
          action: replace
          target_label: instance
        - action: labelmap
          regex: __meta_kubernetes_pod_label_(.+)
      - job_name: kubernetes-kube-proxy
        honor_labels: true
        kubernetes_sd_configs:
        - role: pod
        relabel_configs:
        - action: keep
          source_labels:
          - __meta_kubernetes_namespace
          - __meta_kubernetes_pod_name
          separator: '/'
          regex: 'kube-system/kube-proxy.+'
        - source_labels:
          - __address__
          action: replace
          target_label: __address__
          regex: (.+?)(\\:\\d+)?
          replacement: $1:10249
        - source_labels:
          - __meta_kubernetes_pod_name
          action: replace
          target_label: instance
        - action: labelmap
          regex: __meta_kubernetes_pod_label_(.+)
    recording_rules.yml:
      "groups":
      - "name": "kube-apiserver.rules"
        "rules":
        - "expr": |
            (
              (
                # too slow
                sum(rate(apiserver_request_duration_seconds_count{job="kube-apiserver",verb=~"LIST|GET"}[1d]))
                -
                (
                  (
                    sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope=~"resource|",le="0.1"}[1d]))
                    or
                    vector(0)
                  )
                  +
                  sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope="namespace",le="0.5"}[1d]))
                  +
                  sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope="cluster",le="5"}[1d]))
                )
              )
              +
              # errors
              sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"LIST|GET",code=~"5.."}[1d]))
            )
            /
            sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"LIST|GET"}[1d]))
          "labels":
            "verb": "read"
          "record": "apiserver_request:burnrate1d"
        - "expr": |
            (
              (
                # too slow
                sum(rate(apiserver_request_duration_seconds_count{job="kube-apiserver",verb=~"LIST|GET"}[1h]))
                -
                (
                  (
                    sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope=~"resource|",le="0.1"}[1h]))
                    or
                    vector(0)
                  )
                  +
                  sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope="namespace",le="0.5"}[1h]))
                  +
                  sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope="cluster",le="5"}[1h]))
                )
              )
              +
              # errors
              sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"LIST|GET",code=~"5.."}[1h]))
            )
            /
            sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"LIST|GET"}[1h]))
          "labels":
            "verb": "read"
          "record": "apiserver_request:burnrate1h"
        - "expr": |
            (
              (
                # too slow
                sum(rate(apiserver_request_duration_seconds_count{job="kube-apiserver",verb=~"LIST|GET"}[2h]))
                -
                (
                  (
                    sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope=~"resource|",le="0.1"}[2h]))
                    or
                    vector(0)
                  )
                  +
                  sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope="namespace",le="0.5"}[2h]))
                  +
                  sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope="cluster",le="5"}[2h]))
                )
              )
              +
              # errors
              sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"LIST|GET",code=~"5.."}[2h]))
            )
            /
            sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"LIST|GET"}[2h]))
          "labels":
            "verb": "read"
          "record": "apiserver_request:burnrate2h"
        - "expr": |
            (
              (
                # too slow
                sum(rate(apiserver_request_duration_seconds_count{job="kube-apiserver",verb=~"LIST|GET"}[30m]))
                -
                (
                  (
                    sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope=~"resource|",le="0.1"}[30m]))
                    or
                    vector(0)
                  )
                  +
                  sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope="namespace",le="0.5"}[30m]))
                  +
                  sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope="cluster",le="5"}[30m]))
                )
              )
              +
              # errors
              sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"LIST|GET",code=~"5.."}[30m]))
            )
            /
            sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"LIST|GET"}[30m]))
          "labels":
            "verb": "read"
          "record": "apiserver_request:burnrate30m"
        - "expr": |
            (
              (
                # too slow
                sum(rate(apiserver_request_duration_seconds_count{job="kube-apiserver",verb=~"LIST|GET"}[3d]))
                -
                (
                  (
                    sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope=~"resource|",le="0.1"}[3d]))
                    or
                    vector(0)
                  )
                  +
                  sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope="namespace",le="0.5"}[3d]))
                  +
                  sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope="cluster",le="5"}[3d]))
                )
              )
              +
              # errors
              sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"LIST|GET",code=~"5.."}[3d]))
            )
            /
            sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"LIST|GET"}[3d]))
          "labels":
            "verb": "read"
          "record": "apiserver_request:burnrate3d"
        - "expr": |
            (
              (
                # too slow
                sum(rate(apiserver_request_duration_seconds_count{job="kube-apiserver",verb=~"LIST|GET"}[5m]))
                -
                (
                  (
                    sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope=~"resource|",le="0.1"}[5m]))
                    or
                    vector(0)
                  )
                  +
                  sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope="namespace",le="0.5"}[5m]))
                  +
                  sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope="cluster",le="5"}[5m]))
                )
              )
              +
              # errors
              sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"LIST|GET",code=~"5.."}[5m]))
            )
            /
            sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"LIST|GET"}[5m]))
          "labels":
            "verb": "read"
          "record": "apiserver_request:burnrate5m"
        - "expr": |
            (
              (
                # too slow
                sum(rate(apiserver_request_duration_seconds_count{job="kube-apiserver",verb=~"LIST|GET"}[6h]))
                -
                (
                  (
                    sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope=~"resource|",le="0.1"}[6h]))
                    or
                    vector(0)
                  )
                  +
                  sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope="namespace",le="0.5"}[6h]))
                  +
                  sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope="cluster",le="5"}[6h]))
                )
              )
              +
              # errors
              sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"LIST|GET",code=~"5.."}[6h]))
            )
            /
            sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"LIST|GET"}[6h]))
          "labels":
            "verb": "read"
          "record": "apiserver_request:burnrate6h"
        - "expr": |
            (
              (
                # too slow
                sum(rate(apiserver_request_duration_seconds_count{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE"}[1d]))
                -
                sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE",le="1"}[1d]))
              )
              +
              sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE",code=~"5.."}[1d]))
            )
            /
            sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE"}[1d]))
          "labels":
            "verb": "write"
          "record": "apiserver_request:burnrate1d"
        - "expr": |
            (
              (
                # too slow
                sum(rate(apiserver_request_duration_seconds_count{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE"}[1h]))
                -
                sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE",le="1"}[1h]))
              )
              +
              sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE",code=~"5.."}[1h]))
            )
            /
            sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE"}[1h]))
          "labels":
            "verb": "write"
          "record": "apiserver_request:burnrate1h"
        - "expr": |
            (
              (
                # too slow
                sum(rate(apiserver_request_duration_seconds_count{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE"}[2h]))
                -
                sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE",le="1"}[2h]))
              )
              +
              sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE",code=~"5.."}[2h]))
            )
            /
            sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE"}[2h]))
          "labels":
            "verb": "write"
          "record": "apiserver_request:burnrate2h"
        - "expr": |
            (
              (
                # too slow
                sum(rate(apiserver_request_duration_seconds_count{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE"}[30m]))
                -
                sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE",le="1"}[30m]))
              )
              +
              sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE",code=~"5.."}[30m]))
            )
            /
            sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE"}[30m]))
          "labels":
            "verb": "write"
          "record": "apiserver_request:burnrate30m"
        - "expr": |
            (
              (
                # too slow
                sum(rate(apiserver_request_duration_seconds_count{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE"}[3d]))
                -
                sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE",le="1"}[3d]))
              )
              +
              sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE",code=~"5.."}[3d]))
            )
            /
            sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE"}[3d]))
          "labels":
            "verb": "write"
          "record": "apiserver_request:burnrate3d"
        - "expr": |
            (
              (
                # too slow
                sum(rate(apiserver_request_duration_seconds_count{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE"}[5m]))
                -
                sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE",le="1"}[5m]))
              )
              +
              sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE",code=~"5.."}[5m]))
            )
            /
            sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE"}[5m]))
          "labels":
            "verb": "write"
          "record": "apiserver_request:burnrate5m"
        - "expr": |
            (
              (
                # too slow
                sum(rate(apiserver_request_duration_seconds_count{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE"}[6h]))
                -
                sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE",le="1"}[6h]))
              )
              +
              sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE",code=~"5.."}[6h]))
            )
            /
            sum(rate(apiserver_request_total{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE"}[6h]))
          "labels":
            "verb": "write"
          "record": "apiserver_request:burnrate6h"
        - "expr": |
            sum by (code,resource) (rate(apiserver_request_total{job="kube-apiserver",verb=~"LIST|GET"}[5m]))
          "labels":
            "verb": "read"
          "record": "code_resource:apiserver_request_total:rate5m"
        - "expr": |
            sum by (code,resource) (rate(apiserver_request_total{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE"}[5m]))
          "labels":
            "verb": "write"
          "record": "code_resource:apiserver_request_total:rate5m"
        - "expr": |
            histogram_quantile(0.99, sum by (le, resource) (rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET"}[5m]))) > 0
          "labels":
            "quantile": "0.99"
            "verb": "read"
          "record": "cluster_quantile:apiserver_request_duration_seconds:histogram_quantile"
        - "expr": |
            histogram_quantile(0.99, sum by (le, resource) (rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"POST|PUT|PATCH|DELETE"}[5m]))) > 0
          "labels":
            "quantile": "0.99"
            "verb": "write"
          "record": "cluster_quantile:apiserver_request_duration_seconds:histogram_quantile"
        - "expr": |
            sum(rate(apiserver_request_duration_seconds_sum{subresource!="log",verb!~"LIST|WATCH|WATCHLIST|DELETECOLLECTION|PROXY|CONNECT"}[5m])) without(instance, pod)
            /
            sum(rate(apiserver_request_duration_seconds_count{subresource!="log",verb!~"LIST|WATCH|WATCHLIST|DELETECOLLECTION|PROXY|CONNECT"}[5m])) without(instance, pod)
          "record": "cluster:apiserver_request_duration_seconds:mean5m"
        - "expr": |
            histogram_quantile(0.99, sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",subresource!="log",verb!~"LIST|WATCH|WATCHLIST|DELETECOLLECTION|PROXY|CONNECT"}[5m])) without(instance, pod))
          "labels":
            "quantile": "0.99"
          "record": "cluster_quantile:apiserver_request_duration_seconds:histogram_quantile"
        - "expr": |
            histogram_quantile(0.9, sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",subresource!="log",verb!~"LIST|WATCH|WATCHLIST|DELETECOLLECTION|PROXY|CONNECT"}[5m])) without(instance, pod))
          "labels":
            "quantile": "0.9"
          "record": "cluster_quantile:apiserver_request_duration_seconds:histogram_quantile"
        - "expr": |
            histogram_quantile(0.5, sum(rate(apiserver_request_duration_seconds_bucket{job="kube-apiserver",subresource!="log",verb!~"LIST|WATCH|WATCHLIST|DELETECOLLECTION|PROXY|CONNECT"}[5m])) without(instance, pod))
          "labels":
            "quantile": "0.5"
          "record": "cluster_quantile:apiserver_request_duration_seconds:histogram_quantile"
      - "interval": "3m"
        "name": "kube-apiserver-availability.rules"
        "rules":
        - "expr": |
            1 - (
              (
                # write too slow
                sum(increase(apiserver_request_duration_seconds_count{verb=~"POST|PUT|PATCH|DELETE"}[30d]))
                -
                sum(increase(apiserver_request_duration_seconds_bucket{verb=~"POST|PUT|PATCH|DELETE",le="1"}[30d]))
              ) +
              (
                # read too slow
                sum(increase(apiserver_request_duration_seconds_count{verb=~"LIST|GET"}[30d]))
                -
                (
                  (
                    sum(increase(apiserver_request_duration_seconds_bucket{verb=~"LIST|GET",scope=~"resource|",le="0.1"}[30d]))
                    or
                    vector(0)
                  )
                  +
                  sum(increase(apiserver_request_duration_seconds_bucket{verb=~"LIST|GET",scope="namespace",le="0.5"}[30d]))
                  +
                  sum(increase(apiserver_request_duration_seconds_bucket{verb=~"LIST|GET",scope="cluster",le="5"}[30d]))
                )
              ) +
              # errors
              sum(code:apiserver_request_total:increase30d{code=~"5.."} or vector(0))
            )
            /
            sum(code:apiserver_request_total:increase30d)
          "labels":
            "verb": "all"
          "record": "apiserver_request:availability30d"
        - "expr": |
            1 - (
              sum(increase(apiserver_request_duration_seconds_count{job="kube-apiserver",verb=~"LIST|GET"}[30d]))
              -
              (
                # too slow
                (
                  sum(increase(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope=~"resource|",le="0.1"}[30d]))
                  or
                  vector(0)
                )
                +
                sum(increase(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope="namespace",le="0.5"}[30d]))
                +
                sum(increase(apiserver_request_duration_seconds_bucket{job="kube-apiserver",verb=~"LIST|GET",scope="cluster",le="5"}[30d]))
              )
              +
              # errors
              sum(code:apiserver_request_total:increase30d{verb="read",code=~"5.."} or vector(0))
            )
            /
            sum(code:apiserver_request_total:increase30d{verb="read"})
          "labels":
            "verb": "read"
          "record": "apiserver_request:availability30d"
        - "expr": |
            1 - (
              (
                # too slow
                sum(increase(apiserver_request_duration_seconds_count{verb=~"POST|PUT|PATCH|DELETE"}[30d]))
                -
                sum(increase(apiserver_request_duration_seconds_bucket{verb=~"POST|PUT|PATCH|DELETE",le="1"}[30d]))
              )
              +
              # errors
              sum(code:apiserver_request_total:increase30d{verb="write",code=~"5.."} or vector(0))
            )
            /
            sum(code:apiserver_request_total:increase30d{verb="write"})
          "labels":
            "verb": "write"
          "record": "apiserver_request:availability30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="LIST",code=~"2.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="GET",code=~"2.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="POST",code=~"2.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="PUT",code=~"2.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="PATCH",code=~"2.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="DELETE",code=~"2.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="LIST",code=~"3.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="GET",code=~"3.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="POST",code=~"3.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="PUT",code=~"3.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="PATCH",code=~"3.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="DELETE",code=~"3.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="LIST",code=~"4.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="GET",code=~"4.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="POST",code=~"4.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="PUT",code=~"4.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="PATCH",code=~"4.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="DELETE",code=~"4.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="LIST",code=~"5.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="GET",code=~"5.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="POST",code=~"5.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="PUT",code=~"5.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="PATCH",code=~"5.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code, verb) (increase(apiserver_request_total{job="kube-apiserver",verb="DELETE",code=~"5.."}[30d]))
          "record": "code_verb:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code) (code_verb:apiserver_request_total:increase30d{verb=~"LIST|GET"})
          "labels":
            "verb": "read"
          "record": "code:apiserver_request_total:increase30d"
        - "expr": |
            sum by (code) (code_verb:apiserver_request_total:increase30d{verb=~"POST|PUT|PATCH|DELETE"})
          "labels":
            "verb": "write"
          "record": "code:apiserver_request_total:increase30d"
      - "name": "k8s.rules"
        "rules":
        - "expr": |
            sum(rate(container_cpu_usage_seconds_total{job="kubernetes-nodes-cadvisor", image!="", container!="POD"}[5m])) by (namespace)
          "record": "namespace:container_cpu_usage_seconds_total:sum_rate"
        - "expr": |
            label_replace(
              label_replace(
                sum by (cluster, namespace, created_by_kind, created_by_name, pod, container) (
                  rate(container_cpu_usage_seconds_total{job="kubernetes-nodes-cadvisor", image!="", container!="POD"}[5m])
                  ) 
                  * on (cluster, namespace, pod) group_left(node, created_by_kind, created_by_name)
                    topk by (cluster, namespace, created_by_kind, created_by_name, pod) (1, max by(cluster, namespace, created_by_kind, created_by_name, pod, node) (kube_pod_info{node!=""}))
                , "kube_workload_name", "$1", "created_by_name", "(.*)"
              )
              ,"kube_workload_type", "$1", "created_by_kind", "(.*)"
            )
          "record": "sysdig_container_cpu_cores_used"
          labels:
            sysdig: true
        - "expr": |
            label_replace(
              label_replace(
                container_memory_working_set_bytes{job="kubernetes-nodes-cadvisor", image!=""}
                  * on (namespace, pod) group_left(node, created_by_kind, created_by_name) 
                    topk by(namespace, created_by_kind, created_by_name, pod) (1, max by(namespace, created_by_kind, created_by_name, pod, node) (kube_pod_info{node!=""}))
                , "kube_workload_name", "$1", "created_by_name", "(.*)"
              )
              ,"kube_workload_type", "$1", "created_by_kind", "(.*)"
            )
          "record": "sysdig_container_memory_used_bytes"
          labels:
            sysdig: true
        - "expr": |
            container_memory_rss{job="kubernetes-nodes-cadvisor", image!=""}
            * on (namespace, pod) group_left(node) topk by(namespace, pod) (1,
              max by(namespace, pod, node) (kube_pod_info{node!=""})
            )
          "record": "node_namespace_pod_container:container_memory_rss"
        - "expr": |
            container_memory_cache{job="kubernetes-nodes-cadvisor", image!=""}
            * on (namespace, pod) group_left(node) topk by(namespace, pod) (1,
              max by(namespace, pod, node) (kube_pod_info{node!=""})
            )
          "record": "node_namespace_pod_container:container_memory_cache"
        - "expr": |
            container_memory_swap{job="kubernetes-nodes-cadvisor", image!=""}
            * on (namespace, pod) group_left(node) topk by(namespace, pod) (1,
              max by(namespace, pod, node) (kube_pod_info{node!=""})
            )
          "record": "node_namespace_pod_container:container_memory_swap"
        - "expr": |
            sum(container_memory_usage_bytes{job="kubernetes-nodes-cadvisor", image!="", container!="POD"}) by (namespace)
          "record": "namespace:container_memory_usage_bytes:sum"
        - "expr": |
            sum by (namespace) (
                sum by (namespace, pod) (
                    max by (namespace, pod, container) (
                        kube_pod_container_resource_requests_memory_bytes{job="kubernetes-service-endpoints"}
                    ) * on(namespace, pod) group_left() max by (namespace, pod) (
                        kube_pod_status_phase{phase=~"Pending|Running"} == 1
                    )
                )
            )
          "record": "namespace:kube_pod_container_resource_requests_memory_bytes:sum"
          labels:
            sysdig: true
        - "expr": |
            sum by (namespace) (
                sum by (namespace, pod) (
                    max by (namespace, pod, container) (
                        kube_pod_container_resource_requests_cpu_cores{job="kubernetes-service-endpoints"}
                    ) * on(namespace, pod) group_left() max by (namespace, pod) (
                      kube_pod_status_phase{phase=~"Pending|Running"} == 1
                    )
                )
            )
          "record": "namespace:kube_pod_container_resource_requests_cpu_cores:sum"
          labels:
            sysdig: true
        - "expr": |
            max by (cluster, namespace, workload, pod) (
              label_replace(
                label_replace(
                  kube_pod_owner{job="kubernetes-service-endpoints", owner_kind="ReplicaSet"},
                  "replicaset", "$1", "owner_name", "(.*)"
                ) * on(replicaset, namespace) group_left(owner_name) topk by(replicaset, namespace) (
                  1, max by (replicaset, namespace, owner_name) (
                    kube_replicaset_owner{job="kubernetes-service-endpoints"}
                  )
                ),
                "workload", "$1", "owner_name", "(.*)"
              )
            )
          "labels":
            "workload_type": "deployment"
            sysdig: true
          "record": "namespace_workload_pod:kube_pod_owner:relabel"
        - "expr": |
            max by (cluster, namespace, workload, pod) (
              label_replace(
                kube_pod_owner{job="kubernetes-service-endpoints", owner_kind="DaemonSet"},
                "workload", "$1", "owner_name", "(.*)"
              )
            )
          "labels":
            "workload_type": "daemonset"
            sysdig: true
          "record": "namespace_workload_pod:kube_pod_owner:relabel"
        - "expr": |
            max by (cluster, namespace, workload, pod) (
              label_replace(
                kube_pod_owner{job="kubernetes-service-endpoints", owner_kind="StatefulSet"},
                "workload", "$1", "owner_name", "(.*)"
              )
            )
          "labels":
            "workload_type": "statefulset"
            sysdig: true
          "record": "namespace_workload_pod:kube_pod_owner:relabel"
      - "name": "kube-scheduler.rules"
        "rules":
        - "expr": |
            histogram_quantile(0.99, sum(rate(scheduler_e2e_scheduling_duration_seconds_bucket{job="kube-scheduler"}[5m])) without(instance, pod))
          "labels":
            "quantile": "0.99"
          "record": "cluster_quantile:scheduler_e2e_scheduling_duration_seconds:histogram_quantile"
        - "expr": |
            histogram_quantile(0.99, sum(rate(scheduler_scheduling_algorithm_duration_seconds_bucket{job="kube-scheduler"}[5m])) without(instance, pod))
          "labels":
            "quantile": "0.99"
          "record": "cluster_quantile:scheduler_scheduling_algorithm_duration_seconds:histogram_quantile"
        - "expr": |
            histogram_quantile(0.99, sum(rate(scheduler_binding_duration_seconds_bucket{job="kube-scheduler"}[5m])) without(instance, pod))
          "labels":
            "quantile": "0.99"
          "record": "cluster_quantile:scheduler_binding_duration_seconds:histogram_quantile"
        - "expr": |
            histogram_quantile(0.9, sum(rate(scheduler_e2e_scheduling_duration_seconds_bucket{job="kube-scheduler"}[5m])) without(instance, pod))
          "labels":
            "quantile": "0.9"
          "record": "cluster_quantile:scheduler_e2e_scheduling_duration_seconds:histogram_quantile"
        - "expr": |
            histogram_quantile(0.9, sum(rate(scheduler_scheduling_algorithm_duration_seconds_bucket{job="kube-scheduler"}[5m])) without(instance, pod))
          "labels":
            "quantile": "0.9"
          "record": "cluster_quantile:scheduler_scheduling_algorithm_duration_seconds:histogram_quantile"
        - "expr": |
            histogram_quantile(0.9, sum(rate(scheduler_binding_duration_seconds_bucket{job="kube-scheduler"}[5m])) without(instance, pod))
          "labels":
            "quantile": "0.9"
          "record": "cluster_quantile:scheduler_binding_duration_seconds:histogram_quantile"
        - "expr": |
            histogram_quantile(0.5, sum(rate(scheduler_e2e_scheduling_duration_seconds_bucket{job="kube-scheduler"}[5m])) without(instance, pod))
          "labels":
            "quantile": "0.5"
          "record": "cluster_quantile:scheduler_e2e_scheduling_duration_seconds:histogram_quantile"
        - "expr": |
            histogram_quantile(0.5, sum(rate(scheduler_scheduling_algorithm_duration_seconds_bucket{job="kube-scheduler"}[5m])) without(instance, pod))
          "labels":
            "quantile": "0.5"
          "record": "cluster_quantile:scheduler_scheduling_algorithm_duration_seconds:histogram_quantile"
        - "expr": |
            histogram_quantile(0.5, sum(rate(scheduler_binding_duration_seconds_bucket{job="kube-scheduler"}[5m])) without(instance, pod))
          "labels":
            "quantile": "0.5"
          "record": "cluster_quantile:scheduler_binding_duration_seconds:histogram_quantile"
      - "name": "node.rules"
        "rules":
        - "expr": |
            sum(min(kube_pod_info{node!=""}) by (cluster, node))
          "record": ":kube_pod_info_node_count:"
        - "expr": |
            topk by(namespace, pod) (1,
              max by (node, namespace, pod) (
                label_replace(kube_pod_info{job="kubernetes-service-endpoints",node!=""}, "pod", "$1", "pod", "(.*)")
            ))
          "record": "node_namespace_pod:kube_pod_info:"
        - "expr": |
            count by (cluster, node) (sum by (node, cpu) (
              node_cpu_seconds_total{job="node-exporter"}
            * on (namespace, pod) group_left(node)
              node_namespace_pod:kube_pod_info:
            ))
          "record": "node:node_num_cpu:sum"
        - "expr": |
            sum(
              node_memory_MemAvailable_bytes{job="node-exporter"} or
              (
                node_memory_Buffers_bytes{job="node-exporter"} +
                node_memory_Cached_bytes{job="node-exporter"} +
                node_memory_MemFree_bytes{job="node-exporter"} +
                node_memory_Slab_bytes{job="node-exporter"}
              )
            ) by (cluster)
          "record": ":node_memory_MemAvailable_bytes:sum"
          labels:
            sysdig: true
      - "name": "kubelet.rules"
        "rules":
        - "expr": |
            histogram_quantile(0.99, sum(rate(kubelet_pleg_relist_duration_seconds_bucket[5m])) by (instance, le) * on(instance) group_left(node) kubelet_node_name{job="kubelet"})
          "labels":
            "quantile": "0.99"
          "record": "node_quantile:kubelet_pleg_relist_duration_seconds:histogram_quantile"
        - "expr": |
            histogram_quantile(0.9, sum(rate(kubelet_pleg_relist_duration_seconds_bucket[5m])) by (instance, le) * on(instance) group_left(node) kubelet_node_name{job="kubelet"})
          "labels":
            "quantile": "0.9"
          "record": "node_quantile:kubelet_pleg_relist_duration_seconds:histogram_quantile"
        - "expr": |
            histogram_quantile(0.5, sum(rate(kubelet_pleg_relist_duration_seconds_bucket[5m])) by (instance, le) * on(instance) group_left(node) kubelet_node_name{job="kubelet"})
          "labels":
            "quantile": "0.5"
          "record": "node_quantile:kubelet_pleg_relist_duration_seconds:histogram_quantile"

      - name: ksm.sysdig
        rules:
        - expr: kube_pod_container_resource_requests_cpu_cores
          record: kube_pod_container_resource_requests_cpu_cores:sysdig
          labels:
            sysdig: true
        - expr: kube_node_status_allocatable_cpu_cores
          record: kube_node_status_allocatable_cpu_cores:sysdig
          labels:
            sysdig: true
        - expr: kube_pod_container_resource_limits_cpu_cores
          record: kube_pod_container_resource_limits_cpu_cores:sysdig
          labels:
            sysdig: true
        - expr: kube_node_status_allocatable_memory_bytes
          record: kube_node_status_allocatable_memory_bytes:sysdig
          labels:
            sysdig: true
        - expr: kube_pod_container_resource_requests_memory_bytes
          record: kube_pod_container_resource_requests_memory_bytes:sysdig
          labels:
            sysdig: true
        - expr: kube_pod_container_resource_limits_memory_bytes
          record: kube_pod_container_resource_limits_memory_bytes:sysdig
          labels:
            sysdig: true
        - expr: container_memory_rss{container!=""}
          record: container_memory_rss:sysdig
          labels:
            sysdig: true
        - expr: container_memory_cache
          record: container_memory_cache:sysdig
          labels:
            sysdig: true
        - expr: kube_pod_owner
          record: kube_pod_owner:sysdig
          labels:
            sysdig: true
        - expr: kube_replicaset_owner
          record: kube_replicaset_owner:sysdig
          labels:
            sysdig: true
        - expr: |
            100 * sum(sysdig_container_cpu_cores_used) by (namespace, pod, container) / sum(kube_pod_container_resource_requests_cpu_cores) by (namespace, pod, container)
          record: node_namespace_pod_container:container_cpu_usage_requests:percentage:sysdig
          labels:
            sysdig: true
        - expr: |
            100 * sum(sysdig_container_cpu_cores_used) by (namespace, pod, container) / sum(kube_pod_container_resource_limits_cpu_cores) by (namespace, pod, container)
          record: node_namespace_pod_container:container_cpu_usage_limits:percentage:sysdig
          labels:
            sysdig: true
        - expr: |
            100 * sum(container_memory_working_set_bytes{container!="",container!="POD"}) by (namespace, pod, container) / sum(kube_pod_container_resource_requests_memory_bytes) by (namespace, pod, container)
          record: node_namespace_pod_container:container_memory_usage_requests:percentage:sysdig
          labels:
            sysdig: true
        - expr: |
            100 * sum(container_memory_working_set_bytes{container!="",container!="POD"}) by (namespace, pod, container) / sum(kube_pod_container_resource_limits_memory_bytes) by (namespace, pod, container)
          record: node_namespace_pod_container:container_memory_usage_limits:percentage:sysdig
          labels:
            sysdig: true
        - expr: |
            label_replace(
                kube_deployment_status_replicas{job="kubernetes-service-endpoints"},
                "workload", "$1", "deployment", "(.*)"
              )
          record: kube_workload_status_desired:sysdig
          labels:
            workload_type: deployment
            sysdig: true
        - expr: |
            label_replace(
                kube_daemonset_status_current_number_scheduled{job="kubernetes-service-endpoints"},
                "workload", "$1", "daemonset", "(.*)"
              )
          record: kube_workload_status_desired:sysdig
          labels:
            workload_type: daemonset
            sysdig: true
        - expr: |
            label_replace(
                kube_statefulset_status_replicas{job="kubernetes-service-endpoints"},
                "workload", "$1", "statefulset", "(.*)"
              )
          record: kube_workload_status_desired:sysdig
          labels:
            workload_type: statefulset
            sysdig: true

        - expr: |
            label_replace(
                kube_deployment_status_replicas_available{job="kubernetes-service-endpoints"},
                "workload", "$1", "deployment", "(.*)"
              )
          record: kube_workload_status_available:sysdig
          labels:
            workload_type: deployment
            sysdig: true
        - expr: |
            label_replace(
                kube_daemonset_status_number_available{job="kubernetes-service-endpoints"},
                "workload", "$1", "daemonset", "(.*)"
              )
          record: kube_workload_status_available:sysdig
          labels:
            workload_type: daemonset
            sysdig: true
        - expr: |
            label_replace(
                kube_statefulset_status_replicas_ready{job="kubernetes-service-endpoints"},
                "workload", "$1", "statefulset", "(.*)"
              )
          record: kube_workload_status_available:sysdig
          labels:
            workload_type: statefulset
            sysdig: true

        - expr: |
            label_replace(
                kube_deployment_status_replicas_updated{job="kubernetes-service-endpoints"},
                "workload", "$1", "deployment", "(.*)"
              )
          record: kube_workload_status_updated:sysdig
          labels:
            workload_type: deployment
            sysdig: true
        - expr: |
            label_replace(
                kube_daemonset_updated_number_scheduled{job="kubernetes-service-endpoints"},
                "workload", "$1", "daemonset", "(.*)"
              )
          record: kube_workload_status_updated:sysdig
          labels:
            workload_type: daemonset
            sysdig: true
        - expr: |
            label_replace(
                kube_statefulset_status_replicas_updated{job="kubernetes-service-endpoints"},
                "workload", "$1", "statefulset", "(.*)"
              )
          record: kube_workload_status_updated:sysdig
          labels:
            workload_type: statefulset
            sysdig: true
        - expr: 
            count by (namespace,owner_name)(
              kube_job_status_failed
              * on (job_name) group_left(owner_name) kube_job_owner==1
            ) 
          record: kube_job_status_failed_by_namespace:count:sysdig
          labels:
            sysdig: true
        - expr: |
            count by (namespace,owner_name) (
              kube_job_complete{condition='true'} 
              * on (job_name) group_left(owner_name) kube_job_owner ==1
            )
          record: kube_job_complete_by_namespace:count:sysdig
          labels:
            sysdig: true
        - expr: kube_pod_status_phase
          record: kube_pod_status_phase:sysdig
          labels:
            sysdig: true
        - expr: kube_pod_status_reason
          record: kube_pod_status_reason:sysdig
          labels:
            sysdig: true
        - expr: kube_pod_container_status_waiting_reason
          record: kube_pod_container_status_waiting_reason:sysdig
          labels:
            sysdig: true
        - expr: kube_pod_container_status_terminated_reason
          record: kube_pod_container_status_terminated_reason:sysdig
          labels:
            sysdig: true
        - expr: kube_pod_init_container_status_waiting_reason
          record: kube_pod_init_container_status_waiting_reason:sysdig
          labels:
            sysdig: true
        - expr: kube_pod_init_container_status_terminated_reason
          record: kube_pod_init_container_status_terminated_reason:sysdig
          labels:
            sysdig: true
        - expr: kube_pod_container_status_restarts_total
          record: kube_pod_container_status_restarts_total:sysdig
          labels:
            sysdig: true
        - expr: kube_deployment_status_observed_generation
          record: kube_deployment_status_observed_generation:sysdig
          labels:
            sysdig: true
        - expr: kube_deployment_metadata_generation
          record: kube_deployment_metadata_generation:sysdig
          labels:
            sysdig: true
        - expr: kube_statefulset_status_observed_generation
          record: kube_statefulset_status_observed_generation:sysdig
          labels:
            sysdig: true
        - expr: kube_statefulset_metadata_generation
          record: kube_statefulset_metadata_generation:sysdig
          labels:
            sysdig: true
        - expr: kube_statefulset_replicas
          record: kube_statefulset_replicas:sysdig
          labels:
            sysdig: true
        - expr: kube_statefulset_status_current_revision
          record: kube_statefulset_status_current_revision:sysdig
          labels:
            sysdig: true
        - expr: kube_statefulset_status_update_revision
          record: kube_statefulset_status_update_revision:sysdig
          labels:
            sysdig: true
        - expr: kube_daemonset_status_number_ready
          record: kube_daemonset_status_number_ready:sysdig
          labels:
            sysdig: true
        - expr: kube_daemonset_status_desired_number_scheduled
          record: kube_daemonset_status_desired_number_scheduled:sysdig
          labels:
            sysdig: true
        - expr: kube_daemonset_status_current_number_scheduled
          record: kube_daemonset_status_current_number_scheduled:sysdig
          labels:
            sysdig: true
        - expr: kube_daemonset_status_number_misscheduled
          record: kube_daemonset_status_number_misscheduled:sysdig
          labels:
            sysdig: true
        - expr: kube_job_spec_completions
          record: kube_job_spec_completions:sysdig
          labels:
            sysdig: true
        - expr: kube_job_status_succeeded
          record: kube_job_status_succeeded:sysdig
          labels:
            sysdig: true
        - expr: kube_job_failed
          record: kube_job_failed:sysdig
          labels:
            sysdig: true
        - expr: kube_resourcequota
          record: kube_resourcequota:sysdig
          labels:
            sysdig: true
        - expr: container_cpu_cfs_throttled_periods_total
          record: container_cpu_cfs_throttled_periods_total:sysdig
          labels:
            sysdig: true
        - expr: container_cpu_cfs_periods_total
          record: container_cpu_cfs_periods_total:sysdig
          labels:
            sysdig: true
        - expr: kube_node_status_condition
          record: kube_node_status_condition:sysdig
          labels:
            sysdig: true
        - expr: kube_node_spec_taint
          record: kube_node_spec_taint:sysdig
          labels:
            sysdig: true
        - expr: kube_pod_info
          record: kube_pod_info:sysdig
          labels:
            sysdig: true
        - expr: kube_node_status_capacity_pods
          record: kube_node_status_capacity_pods:sysdig
          labels:
            sysdig: true
        - expr: |
            sum by (kube_workload_name,namespace)(label_replace(kube_pod_status_ready  * on(pod) group_left(created_by_name) kube_pod_info, "kube_workload_name", "$1", "created_by_name", "(.*)"))
          record: kube_workload_status_ready
          labels:
            kube_workload_type: deployment
            sysdig: true